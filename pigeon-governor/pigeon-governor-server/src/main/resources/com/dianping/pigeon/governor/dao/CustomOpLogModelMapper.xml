<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dianping.pigeon.governor.dao.CustomOpLogModelMapper" >
    <resultMap id="BaseResultMap" type="com.dianping.pigeon.governor.model.OpLog" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="content" property="content" jdbcType="VARCHAR" />
        <result column="reqIp" property="reqip" jdbcType="VARCHAR" />
        <result column="dpaccount" property="dpaccount" jdbcType="VARCHAR" />
        <result column="opTime" property="optime" jdbcType="TIMESTAMP" />
        <result column="opType" property="optype" jdbcType="SMALLINT" />
        <result column="projectId" property="projectid" jdbcType="INTEGER" />
    </resultMap>
    <select id="getRecentTopNLogs" resultType="com.dianping.pigeon.governor.model.OpLog">
        SELECT * FROM oplog ORDER BY oplog.updatetime DESC limit #{topN}
    </select>
    <select id="getTotalCount" resultType="java.lang.Integer">
        SELECT count(*) FROM oplog
    </select>
    <select id="filterOpLogs" resultType="com.dianping.pigeon.governor.model.OpLog">
        SELECT * FROM oplog
        WHERE oplog.opTime &gt;= #{start} AND oplog.opTime &lt;= #{end}
        <if test="projectId != -1">
            AND (#{projectId} = projectId)
        </if>
        <if test="type != -1">
            AND (#{type} = opType)
        </if>
    </select>
</mapper>