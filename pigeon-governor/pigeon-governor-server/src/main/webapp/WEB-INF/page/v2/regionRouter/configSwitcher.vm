#set($layout="layoutblank.vm")
<link href="${rc.contextPath}/resources/style/bootstrap-switch.min.css" rel="stylesheet">
<style type="text/css">

    .vertical-center{
        float: none !important;
    }

</style>
<script src="${rc.contextPath}/resources/js/bootstrap-switch.min.js"></script>

<script src="${rc.contextPath}/resources/assets/js/bootbox.min.js"></script>
<div class="row">
    <div class="col-xs-12">
        <div class="pull-right"><span style="font-size: small">Region路由状态: &nbsp;</span>
            <input id="switch" type="checkbox" name="my-checkbox" />
        </div>
        <script>
            jQuery(function($) {
                var hash = window.location.hash;
                var projectName = hash.split("/")[2];
                var enable = $empowered;
                var enableState = $enableState;
                <!--配置bootstrapSwitch-->
                $.fn.bootstrapSwitch.defaults.onText = '<i class="ace-icon glyphicon glyphicon-play white"></i><span class="white">开启</span>';
                $.fn.bootstrapSwitch.defaults.offText = '<i class="ace-icon glyphicon glyphicon-pause red"></i><span class="red">关闭</span>';
                $.fn.bootstrapSwitch.defaults.size='mini';
                $("[name='my-checkbox']").bootstrapSwitch();
                if(enableState){
                    $("[name='my-checkbox']").bootstrapSwitch('state',true);
                    console.log("enabledState:"+enableState);
                }
                else{
                    $("[name='my-checkbox']").bootstrapSwitch('state',false);
                    console.log("enabledState:"+enableState);
                }
                if(enable){
                    $("[name='my-checkbox']").bootstrapSwitch('disabled',false);
                    console.log("disabled:false");
                }

                else{
                    $("[name='my-checkbox']").bootstrapSwitch('disabled',true);
                    console.log("disabled:true");
                }
                $('input[name="my-checkbox"]').on('switchChange.bootstrapSwitch', function(event, state) {
                    if(state){
                        $("[name='my-checkbox']").bootstrapSwitch("state",false,true);
                        bootbox.dialog({
                            message: "<span class='bigger-110'>是否开启Region路由</span>",
                            buttons:
                            {
                                "confirm" :
                                {
                                    "label" : "确认开启",
                                    "className" : "btn-sm btn-danger",
                                    "callback": function() {
                                        $.ajax({
                                            type: "post",
                                            url: "/region/setRegionEnableState",
                                            data: {'projectName': projectName,'state':'true'},
                                            dataType: "html",
                                            async: true,
                                            success: function (data) {
                                                bootbox.dialog({
                                                    message: "开启成功!",
                                                    buttons: {
                                                        "success": {
                                                            "label": "<i class='ace-icon fa fa-check'></i> Confirm",
                                                            "className": "btn-sm btn-success"
                                                        }
                                                    }
                                                });
                                                $("[name='my-checkbox']").bootstrapSwitch("state",true,true);
                                            }
                                        });
                                    }
                                },
                                "cancel" :
                                {
                                    "label" : "保持关闭",
                                    "className" : "btn-sm btn-success",
                                    "callback": function() {
                                    }
                                }
                            }
                        });
                    }else{
                        $("[name='my-checkbox']").bootstrapSwitch("state",true,true);
                        bootbox.dialog({
                            message: "<span class='bigger-110'>是否关闭Region路由</span>",
                            buttons:
                            {
                                "confirm" :
                                {
                                    "label" : "确认关闭",
                                    "className" : "btn-sm btn-danger",
                                    "callback": function() {
                                        //TODO
                                        $.ajax({
                                            type: "post",
                                            url: "/region/setRegionEnableState",
                                            data: {'projectName': projectName,'state':'false'},
                                            dataType: "html",
                                            async: true,
                                            success: function (data) {
                                                bootbox.dialog({
                                                    message: "关闭成功!",
                                                    buttons: {
                                                        "success": {
                                                            "label": "<i class='ace-icon fa fa-check'></i> Confirm",
                                                            "className": "btn-sm btn-success"
                                                        }
                                                    }
                                                });
                                                $("[name='my-checkbox']").bootstrapSwitch("state",false,true);
                                            }
                                        });
                                    }
                                },
                                "cancel" :
                                {
                                    "label" : "保持开启",
                                    "className" : "btn-sm btn-success",
                                    "callback": function() {
                                    }
                                }
                            }
                        });

                    }
                });
            });
        </script>
    </div>
</div>
<div class ="row">
    <div class="col-xs-12">
        <div class="page-content">
            <div class="page-content-area">
                <h4 class="blue">多region环境路由支持</h4>
                <p>自15年10月新美大合并以来，新公司的业务整合迅速。</p>
                <p>为更好的支持北京侧和上海侧的业务互通需求，架构组件对异地机房，多网络的支持与改进也在持续开发与完善中。</p>
                <p>pigeon的2.7.8-SNAPSHOT版本目前可以提供多region路由支持的测试版本。</p>
                <h4 class="blue">配置简介</h4>
                <p>多region的开关控制由pigeon的配置项pigeon.regions.route.enable来控制，当前线上默认开关为true。此配置项支持动态开关。</p>
                <p>测试阶段，线下全局开关默认为关闭，可在应用级别开启自动切换region的开关。</p>
                <p>如`app.name=xxx`的应用，可以配置xxx.pigeon.regions.route.enable为true。</p>
                <h4 class="blue">Web端控制</h4>
                <p>Pigeon Web可以查看多Region路由状态.
                <p>左上角的开关按钮,可以使得应用的所有者动态调整多Region路由是否开启.无需手动配置.</p>
                <p class="red">后续Pigeon Web将提供更多Region路由的管理功能.</p>
            </div>
        </div>
    </div>
</div>
