#set($layout="layoutblank.vm")
<style type="text/css">
    .save {}
    .value-size {
        word-break:break-all;
    }
    .no-margin{
        margin:0;
    }
    .width-full{
        width:100%;
    }
    .left-text{
        text-align: left;
    }
    .wysiwyg-editor{
        max-height: none;
        width: 100%;
    }

    td {
        vertical-align:middle !important;
    }

    .my-editable{
        display: none;
    }

    .my-empty{
        font-style: italic;
        color: #DD1144;
    }

</style>

<div class="row">
    <div class="col-xs-12">
        <!-- PAGE CONTENT BEGINS -->
        <div>
            <div class="col-xs-12 col-sm-3 pull-left">
                <div class="widget-box transparent">

                    <div class="widget-header widget-header-small">
                        <h4 class="widget-title blue smaller">
                            <i class="ace-icon fa fa-rss orange"></i>
                            服务基本信息
                        </h4>
                        <div class="widget-toolbar action-buttons">
                            <a href="#" data-action="reload">
                                <i class="ace-icon fa fa-refresh blue"></i>
                            </a>
                            <a data-action="collapse" href="#"><i class="ace-icon fa fa-chevron-up"></i></a>
                        </div>
                    </div>

                    <div class="widget-body">
                        <div class="widget-main no-padding">
                            <div class="profile-user-info no-margin width-full">
                                <div class="profile-info-row">
                                    <div class="profile-info-name left-text">所属BU</div>
                                    <div class="profile-info-value">
                                        <span class="blue">$projectBu</span>
                                    </div>
                                </div>
                                <div class="profile-info-row">
                                    <div class="profile-info-name left-text">所属项目</div>

                                    <div class="profile-info-value">
                                        <a href="/services/$projectName" target="_blank" class="blue">$projectName</a>
                                    </div>
                                </div>
                                <div class="profile-info-row">
                                    <div class="profile-info-name left-text">服务所有者</div>
                                    <div class="profile-info-value">
                                        <span class="blue">$projectOwner</span>
                                    </div>
                                </div>
                                <div class="profile-info-row">
                                    <div class="profile-info-name left-text">服务泳道</div>

                                    <div class="profile-info-value">
                                        <span class="blue">$serviceGroup</span>
                                    </div>
                                </div>
                                <div class="profile-info-row">
                                    <div class="profile-info-name left-text value-size">服务地址</div>
                                    <div class="profile-info-value">
                                        #foreach($host in $serviceHosts)
                                            <p class="blue">$host</p>
                                        #end
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-xs-12 col-sm-9 pull-right">
                <div class="javaDoc">
                    <div class="widget-box transparent">
                        <div class="widget-header widget-header-small">
                            <h4 class="widget-title blue smaller">
                                <i class=" glyphicon glyphicon-file orange"></i>
                                服务文档
                                #if($empowered)
                                    <div class="pull-right"><input type="checkbox" name="my-checkbox" checked "></div>
                                #end
                            </h4>
                        </div>
                        <div class="widget-body">
                            <div class="widget-main no-padding">
                                <div>
                                    <table class="table table-striped table-bordered table-hover">
                                        <tbody>
                                        <tr>
                                            <td class="blue">服务全名</td>
                                            <td class="blue">$serviceDescBean.serviceName</td>
                                        </tr>
                                        <tr>
                                            <td class="blue">服务实现</td>
                                            <td class="blue">$serviceDescBean.serviceImpl</td>
                                        </tr>
                                        <tr>
                                            <td class="blue">实现描述</td>
                                            <td class="my-editable editable" data-url="/doc/desc/$serviceDescBean.getServiceId()">$serviceDescBean.serviceDesc</td>
                                            <td>
                                                #if($serviceDescBean.serviceDesc == "")
                                                    <span class="my-empty">描述暂空</span>
                                                #end
                                                $serviceDescBean.serviceDesc
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="hr hr-18 blue"></div>
                                <div>
                                    <h4 class="blue">
                                        <i class="ace-icon fa fa-pencil-square-o orange"></i>
                                        方法摘要
                                    </h4>
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead class="thin-border-bottom">
                                        <tr>
                                            <th class="blue">
                                                返回值
                                            </th>

                                            <th class="blue">
                                                方法签名
                                            </th>
                                        </tr>
                                        </thead>
                                        <!-- TODO link the summary to the method description-->
                                        <tbody>
                                            #foreach ($key in $serviceDescBean.getMethodDescBeanList())
                                            <tr>
                                                <td class="blue">
                                                    $key.getMethodReturnType()
                                                </td>
                                                <td>
                                                    <a href="#$key.getMethodId()">$key.getMethodName() (&nbsp;
                                                        #if($key.getParamDescBeanArrayList().size()==1)
                                                            $key.getParamDescBeanArrayList().get(0).getParamName()
                                                        #else
                                                            #foreach($param in $key.getParamDescBeanArrayList())
                                                                #if($velocityCount==$key.getParamDescBeanArrayList().size())
                                                                    $param.getParamName()
                                                                #else
                                                                    $param.getParamName()&nbsp;,&nbsp;
                                                                #end
                                                            #end
                                                        #end
                                                        &nbsp;)
                                                    </a>
                                                </td>
                                            </tr>
                                            #end
                                        </tbody>
                                    </table>
                                </div>
                                <div class="hr hr-18 blue"></div>
                                <div>
                                    <h4 class="blue">
                                        <i class="glyphicon glyphicon-list orange"></i>
                                        方法详细信息
                                    </h4>
                                    #foreach($method in $serviceDescBean.getMethodDescBeanList())
                                        <table class="table table-striped table-bordered table-hover">
                                            <a name="$method.getMethodId()"></a>
                                            <tbody>
                                            <tr>
                                                <td class="blue"><h5>$method.getMethodFullname()</h5></td>
                                            </tr>
                                            <tr>
                                                <td class="my-editable editable" data-url="/doc/method/desc/$method.getMethodId()">$method.getMethodDesc()</td>
                                                <td>
                                                    #if($method.getMethodDesc() == "")
                                                        <span class="my-empty">描述暂空</span>
                                                    #end
                                                    $method.getMethodDesc()
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                        <table class="table table-striped table-bordered table-hover">
                                            <tbody>
                                                #if($method.getParamDescBeanArrayList().size()!=0)
                                                <tr>
                                                    <td rowspan=$method.getParamDescBeanArrayList().size() class="blue ">参数信息</td>
                                                    <td class="blue ">$method.getParamDescBeanArrayList().get(0).getParamName()</td>
                                                    <td class="my-editable editable" data-url="/doc/param/desc/$method.getParamDescBeanArrayList().get(0).getParamId()"
                                                    >$method.getParamDescBeanArrayList().get(0).getParamDesc()</td>
                                                    <td>#if($method.getParamDescBeanArrayList().get(0).getParamDesc()=="")
                                                        <span class="my-empty">描述暂空</span>
                                                    #end
                                                        $method.getParamDescBeanArrayList().get(0).getParamDesc()</td>
                                                </tr>
                                                    #foreach($param in $method.getParamDescBeanArrayList())
                                                        #if($velocityCount!=1)
                                                        <tr>
                                                            <td class="blue ">$param.getParamName()</td>
                                                            <td class="my-editable editable" data-url="/doc/param/desc/$param.getParamId()">$param.getParamDesc()</td>
                                                            <td>#if($param.getParamDesc()=="")
                                                                <span class="my-empty">描述暂空</span>
                                                            #end
                                                                $param.getParamDesc()
                                                            </td>
                                                        </tr>
                                                        #end
                                                    #end
                                                #end
                                                #if($method.getExceptionDescBeanArrayList().size()!=0)
                                                <tr>
                                                    <td class="blue " rowspan=$method.getExceptionDescBeanArrayList().size()>异常信息</td>
                                                    <td class="blue ">$method.getExceptionDescBeanArrayList().get(0).getExceptionName()</td>
                                                    <td class="my-editable editable" data-url="/doc/exception/desc/$method.getExceptionDescBeanArrayList().get(0).getExceptionId()"
                                                    >$method.getExceptionDescBeanArrayList().get(0).getExceptionDesc()</td>
                                                    <td>
                                                        #if($method.getExceptionDescBeanArrayList().get(0).getExceptionDesc()=="")
                                                            <span class="my-empty">描述暂空</span>
                                                        #end
                                                        $method.getExceptionDescBeanArrayList().get(0).getExceptionDesc()
                                                    </td>
                                                </tr>
                                                    #foreach($exception in $method.getExceptionDescBeanArrayList())
                                                        #if($velocityCount!=1)
                                                        <tr>
                                                            <td class="blue ">$exception.getExceptionName()</td>
                                                            <td class="my-editable editable" data-url="/doc/exception/desc/$exception.getExceptionId()">$exception.getExceptionDesc()</td>
                                                            <td>
                                                                #if($exception.getExceptionDesc()=="")
                                                                    <span class="my-empty">描述暂空</span>
                                                                #end
                                                                $exception.getExceptionDesc()
                                                            </td>
                                                        </tr>
                                                        #end
                                                    #end
                                                #end
                                            </tbody>
                                        </table>
                                        <hr>
                                    #end
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- /.col -->
</div>
<script src="${rc.contextPath}/resources/assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/jquery.gritter.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/bootbox.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/jquery.easypiechart.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/date-time/bootstrap-datepicker.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/jquery.hotkeys.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/bootstrap-wysiwyg.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/select2.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/fuelux/fuelux.spinner.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/x-editable/bootstrap-editable.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/x-editable/ace-editable.min.js"></script>
<script src="${rc.contextPath}/resources/assets/js/jquery.maskedinput.min.js"></script>
<script src="${rc.contextPath}/resources/js/bootstrap-switch.min.js"></script>
<script type="text/javascript">
    jQuery(function($) {
        <!--配置bootstrapSwitch-->
        $.fn.bootstrapSwitch.defaults.onText = '<i class="ace-icon fa fa-eye white"></i><span class="white">查看</span>';
        $.fn.bootstrapSwitch.defaults.offText = '<i class="glyphicon glyphicon-pencil blue"></i><span class="blue">编辑</span>';
        $.fn.bootstrapSwitch.defaults.size='mini';


        <!--配置x-editable默认ajax方式为POST-->
        $.fn.editable.defaults.ajaxOptions = {type: "POST"};



        $("[name='my-checkbox']").bootstrapSwitch();
        $('input[name="my-checkbox"]').on('switchChange.bootstrapSwitch', function(event, state) {
            console.log(state);
//            if(state==false){
//                bootbox.dialog({
//                    message: "编辑功能暂未开启",
//                    buttons: {
//                        "warn": {
//                            "label": "<i class='ace-icon fa fa-check'></i> Confirm",
//                            "className": "btn-sm btn-success"
//                        }
//                    }
//                });
//            }
            var list = $('.my-editable');
            if(state==true){
                $.each(list,function(){
                    var edit = $(this);
                    if(edit.next().prop('tagName')=='SPAN'){
                        edit.next().hide();
                        edit.next().next().show();
                    }else{
                        edit.hide();
                        edit.next().show();
                    }
                });
            }
            else{
                $.each(list,function () {
                    var edit = $(this);
                    if(edit.next().prop('tagName')=='SPAN'){
                        edit.next().show();
                        edit.next().next().hide();
                    }else{
                        edit.show();
                        edit.next().hide();
                    }
                });
            }


        });
        $('td.editable').editable({
            type: 'textarea',
            mode: 'inline',
            type: 'wysiwyg',
            pk:1,
            onblur:'ignore',
            emptytext:'描述暂空,单击此处编辑文档',
            wysiwyg : {
                css : {'max-width':'100%','width':'100%'}
            },
            success: function(response, newValue) {
                <!-- TODO 考虑是否添加response状态标记是否提交成功 -->
                var value = newValue;
                var viewElement = $(this).next().next();
                bootbox.dialog({
                    message: "修改成功!",
                    buttons: {
                        "success": {
                            "label": "<i class='ace-icon fa fa-check'></i> Confirm",
                            "className": "btn-sm btn-success"
                        }
                    }
                });
                if(value==""){
                    viewElement.html('<span class="my-empty">描述暂空</span>');
                }else
                    viewElement.html(value);
            }
        });
    });
</script>